version: 2

models:
  # Hubs
  - name: hub_rdv_ind
    tests:
      - unique:
          column_name: hub_ind_pk
      - not_null:
          column_name: hub_ind_pk
      - not_null:
          column_name: hub_ind_bk

  - name: hub_rdv_fact
    tests:
      - unique:
          column_name: hub_fact_pk
      - not_null:
          column_name: hub_fact_pk
      - not_null:
          column_name: bk_hub_ind_pk

  - name: hub_rdv_accounting_fin_indicator
    tests:
      - unique:
          column_name: hub_accounting_fin_indicator_pk
      - not_null:
          column_name: hub_accounting_fin_indicator_pk
      - not_null:
          column_name: hub_accounting_fin_indicator_bk

  - name: hub_rdv_asset
    tests:
      - unique:
          column_name: hub_asset_pk
      - not_null:
          column_name: hub_asset_pk
      - not_null:
          column_name: hub_asset_bk

  - name: hub_rdv_organization
    tests:
      - unique:
          column_name: hub_organization_pk
      - not_null:
          column_name: hub_organization_pk
      - not_null:
          column_name: hub_organization_bk

  - name: hub_rdv_data_type
    tests:
      - unique:
          column_name: hub_data_type_pk
      - not_null:
          column_name: hub_data_type_pk
      - not_null:
          column_name: hub_data_type_bk

  - name: hub_rdv_date_type
    tests:
      - unique:
          column_name: hub_date_type_pk
      - not_null:
          column_name: hub_date_type_pk
      - not_null:
          column_name: hub_date_type_bk

  - name: hub_rdv_economic_activity_type
    tests:
      - unique:
          column_name: hub_economic_activity_type_pk
      - not_null:
          column_name: hub_economic_activity_type_pk
      - not_null:
          column_name: hub_economic_activity_type_bk

  - name: hub_rdv_metric
    tests:
      - unique:
          column_name: hub_metric_pk
      - not_null:
          column_name: hub_metric_pk
      - not_null:
          column_name: hub_metric_bk

  - name: hub_rdv_unit
    tests:
      - unique:
          column_name: hub_unit_pk
      - not_null:
          column_name: hub_unit_pk
      - not_null:
          column_name: hub_unit_bk

  - name: hub_rdv_value_type
    tests:
      - unique:
          column_name: hub_value_type_pk
      - not_null:
          column_name: hub_value_type_pk
      - not_null:
          column_name: hub_value_type_bk

  # Links
  - name: link_rdv_ind_fact
    tests:
      - unique:
          column_name: link_ind_fact_pk
      - not_null:
          column_name: link_ind_fact_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_fact_pk
            to: ref('hub_rdv_fact')
            field: hub_fact_pk

  - name: link_rdv_ind_accounting_fin_indicator
    tests:
      - unique:
          column_name: link_ind_accounting_fin_indicator_pk
      - not_null:
          column_name: link_ind_accounting_fin_indicator_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_accounting_fin_indicator_pk
            to: ref('hub_rdv_accounting_fin_indicator')
            field: hub_accounting_fin_indicator_pk

  - name: link_rdv_ind_asset
    tests:
      - unique:
          column_name: link_ind_asset_pk
      - not_null:
          column_name: link_ind_asset_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_asset_pk
            to: ref('hub_rdv_asset')
            field: hub_asset_pk

  - name: link_rdv_ind_data_type
    tests:
      - unique:
          column_name: link_ind_data_type_pk
      - not_null:
          column_name: link_ind_data_type_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_data_type_pk
            to: ref('hub_rdv_data_type')
            field: hub_data_type_pk

  - name: link_rdv_ind_date_type
    tests:
      - unique:
          column_name: link_ind_date_type_pk
      - not_null:
          column_name: link_ind_date_type_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_date_type_pk
            to: ref('hub_rdv_date_type')
            field: hub_date_type_pk

  - name: link_rdv_ind_economic_activity_type
    tests:
      - unique:
          column_name: link_ind_economic_activity_type_pk
      - not_null:
          column_name: link_ind_economic_activity_type_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_economic_activity_type_pk
            to: ref('hub_rdv_economic_activity_type')
            field: hub_economic_activity_type_pk

  - name: link_rdv_ind_metric
    tests:
      - unique:
          column_name: link_ind_metric_pk
      - not_null:
          column_name: link_ind_metric_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_metric_pk
            to: ref('hub_rdv_metric')
            field: hub_metric_pk

  - name: link_rdv_ind_organization
    tests:
      - unique:
          column_name: link_ind_organization_pk
      - not_null:
          column_name: link_ind_organization_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_organization_pk
            to: ref('hub_rdv_organization')
            field: hub_organization_pk

  - name: link_rdv_ind_unit
    tests:
      - unique:
          column_name: link_ind_unit_pk
      - not_null:
          column_name: link_ind_unit_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_unit_pk
            to: ref('hub_rdv_unit')
            field: hub_unit_pk

  - name: link_rdv_ind_value_type
    tests:
      - unique:
          column_name: link_ind_value_type_pk
      - not_null:
          column_name: link_ind_value_type_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_value_type_pk
            to: ref('hub_rdv_value_type')
            field: hub_value_type_pk

  # Satellites
  - name: sat_rdv_ind
    tests:
      - unique:
          column_name: "(hub_ind_pk || '|' || load_dttm)"
      - not_null:
          column_name: hub_ind_pk
      - relationships:
          arguments:
            column_name: hub_ind_pk
            to: ref('hub_rdv_ind')
            field: hub_ind_pk

  - name: sat_rdv_fact
    tests:
      - unique:
          column_name: "(hub_fact_pk || '|' || load_date)"
      - not_null:
          column_name: hub_fact_pk
      - relationships:
          arguments:
            column_name: hub_fact_pk
            to: ref('hub_rdv_fact')
            field: hub_fact_pk

  - name: sat_rdv_fact_value
    tests:
      - unique:
          column_name: "(hub_fact_pk || '|' || load_date)"
      - not_null:
          column_name: hub_fact_pk
      - relationships:
          arguments:
            column_name: hub_fact_pk
            to: ref('hub_rdv_fact')
            field: hub_fact_pk

