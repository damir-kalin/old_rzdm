{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-09T10:56:25.183806Z", "invocation_id": "3264c23f-5097-4d75-83f8-0996ac9b07ae", "invocation_started_at": "2025-12-09T10:55:42.139236Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:44.798465Z", "completed_at": "2025-12-09T10:55:44.811365Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:44.811896Z", "completed_at": "2025-12-09T10:55:46.054121Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2897801399230957, "adapter_response": {"_message": "SUCCESS 658", "code": "SUCCESS", "rows_affected": 658}, "message": "SUCCESS 658", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_accounting_fin_indicator", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0443\u0447\u0435\u0442\u043d\u043e-\u0444\u0438\u043d\u0430\u043d\u0441\u043e\u0432\u044b\u0445 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT\n    LOWER(\n  CONCAT_WS('|', \n    TRIM(REPLACE(COALESCE(CAST(unit_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(data_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(metric AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(discreteness AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(value_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(org_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(eat_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(asset_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(ind_code AS CHAR), ''), CHAR(160), ''))\n  )\n) as hub_accounting_fin_indicator_bk, -- BK \u0432 lowercase\n    MIN(load_dttm) as load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE unit_name IS NOT NULL \n    AND data_type IS NOT NULL\n    AND metric IS NOT NULL\n    AND discreteness IS NOT NULL\n    AND value_type IS NOT NULL\n    AND org_name IS NOT NULL \n    AND eat_name IS NOT NULL \n    AND asset_name IS NOT NULL\n    AND ind_code IS NOT NULL\n  \n  GROUP BY \n  CONCAT_WS('|', \n    TRIM(REPLACE(COALESCE(CAST(unit_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(data_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(metric AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(discreteness AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(value_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(org_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(eat_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(asset_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(ind_code AS CHAR), ''), CHAR(160), ''))\n  )\n, source_nm\n),\n\nhub_data AS (\n  SELECT\n    MD5(hub_accounting_fin_indicator_bk) as hub_accounting_fin_indicator_pk, -- hash \u0438\u0437 lowercase BK\n    hub_accounting_fin_indicator_bk,\n    load_dttm,\n    source_nm\n  FROM source_data\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_accounting_fin_indicator_pk,\n    hub_accounting_fin_indicator_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM hub_data\n  GROUP BY hub_accounting_fin_indicator_pk, hub_accounting_fin_indicator_bk\n)\n\nSELECT\n  hub_accounting_fin_indicator_pk,\n  hub_accounting_fin_indicator_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs\nLIMIT 25000", "relation_name": "`unverified`.`hub_rdv__accounting_fin_indicator`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:46.091392Z", "completed_at": "2025-12-09T10:55:46.095960Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:46.096292Z", "completed_at": "2025-12-09T10:55:47.242384Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1830978393554688, "adapter_response": {"_message": "SUCCESS 6", "code": "SUCCESS", "rows_affected": 6}, "message": "SUCCESS 6", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_asset", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0430\u043a\u0442\u0438\u0432\u043e\u0432\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    asset_name as hub_asset_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE asset_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_asset_bk_raw, CHAR(160), ''))) as hub_asset_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_asset_bk) as hub_asset_pk, -- hash \u0438\u0437 lowercase BK\n    hub_asset_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    asset_name as hub_asset_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE asset_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_asset_bk_raw, CHAR(160), ''))) as hub_asset_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_asset_bk) as hub_asset_pk, -- hash \u0438\u0437 lowercase BK\n    hub_asset_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_new_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n)\n\n-- APPEND-ONLY: \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0442\u0430\u0431\u043b\u0438\u0446\u0443 \u0441 \u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nSELECT DISTINCT\n  hub_asset_pk,\n  hub_asset_bk,\n  load_dttm,\n  source_nm\nFROM all_new_hubs", "relation_name": "`unverified`.`hub_rdv__asset`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:47.280809Z", "completed_at": "2025-12-09T10:55:47.289486Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:47.289974Z", "completed_at": "2025-12-09T10:55:48.309648Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0591211318969727, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_data_type", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 \"\u0422\u0438\u043f \u0434\u0430\u043d\u043d\u044b\u0445\"\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    data_type as hub_data_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE data_type IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_data_type_bk_raw, CHAR(160), ''))) as hub_data_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_data_type_bk) as hub_data_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_data_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    data_type as hub_data_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE data_type IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_data_type_bk_raw, CHAR(160), ''))) as hub_data_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_data_type_bk) as hub_data_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_data_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_data_type_pk,\n    hub_data_type_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_data_type_pk, hub_data_type_bk\n)\n\nSELECT\n  hub_data_type_pk,\n  hub_data_type_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__data_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:48.345455Z", "completed_at": "2025-12-09T10:55:48.353889Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:48.354380Z", "completed_at": "2025-12-09T10:55:49.527670Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2149150371551514, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_date_type", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 \"\u0422\u0438\u043f \u0434\u0430\u0442\u044b\" (\u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    discreteness as hub_date_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE discreteness IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_date_type_bk_raw, CHAR(160), ''))) as hub_date_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_date_type_bk) as hub_date_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_date_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    discreteness as hub_date_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE discreteness IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_date_type_bk_raw, CHAR(160), ''))) as hub_date_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_date_type_bk) as hub_date_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_date_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_date_type_pk,\n    hub_date_type_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_date_type_pk, hub_date_type_bk\n)\n\nSELECT\n  hub_date_type_pk,\n  hub_date_type_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__date_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:49.565141Z", "completed_at": "2025-12-09T10:55:49.572183Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:49.572754Z", "completed_at": "2025-12-09T10:55:50.739104Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2045838832855225, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_economic_activity_type", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0432\u0438\u0434\u043e\u0432 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    eat_name as hub_economic_activity_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE eat_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_economic_activity_type_bk_raw, CHAR(160), ''))) as hub_economic_activity_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_economic_activity_type_bk) as hub_economic_activity_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_economic_activity_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    eat_name as hub_economic_activity_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE eat_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_economic_activity_type_bk_raw, CHAR(160), ''))) as hub_economic_activity_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_economic_activity_type_bk) as hub_economic_activity_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_economic_activity_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_economic_activity_type_pk,\n    hub_economic_activity_type_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_economic_activity_type_pk, hub_economic_activity_type_bk\n)\n\nSELECT\n  hub_economic_activity_type_pk,\n  hub_economic_activity_type_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__economic_activity_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:50.776765Z", "completed_at": "2025-12-09T10:55:50.785228Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:50.785748Z", "completed_at": "2025-12-09T10:55:52.162339Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4158222675323486, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_fact", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0444\u0430\u043a\u0442\u043e\u0432\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    s.unit_name,\n    s.data_type,\n    s.discreteness,\n    s.value_type,\n    s.org_name,\n    s.eat_name,\n    s.asset_name,\n    s.ind_code,\n    s.year,\n    s.quarter,\n    \n  CASE \n    WHEN s.quarter = 1 THEN STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n    WHEN s.quarter = 2 THEN STR_TO_DATE(CONCAT(s.year, '-04-01'), '%Y-%m-%d')\n    WHEN s.quarter = 3 THEN STR_TO_DATE(CONCAT(s.year, '-07-01'), '%Y-%m-%d')\n    WHEN s.quarter = 4 THEN STR_TO_DATE(CONCAT(s.year, '-10-01'), '%Y-%m-%d')\n    ELSE STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n  END\n as period_dt,\n    DATE(s.load_dttm) as report_date,\n    s.load_dttm,\n    s.source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.year IS NOT NULL\n    AND s.quarter IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n),\n\nnormalized_data AS (\n  SELECT\n    -- \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c BK \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f \u0432 lowercase, \u0447\u0442\u043e\u0431\u044b \u0445\u044d\u0448\u0438 \u0431\u044b\u043b\u0438 \u0441\u0442\u0430\u0431\u0438\u043b\u044c\u043d\u044b \u043c\u0435\u0436\u0434\u0443 \u0441\u043b\u043e\u044f\u043c\u0438\n    LOWER(CONCAT_WS('|',\n      TRIM(REPLACE(unit_name, CHAR(160), '')),\n      TRIM(REPLACE(data_type, CHAR(160), '')),\n      TRIM(REPLACE(discreteness, CHAR(160), '')),\n      TRIM(REPLACE(value_type, CHAR(160), '')),\n      TRIM(REPLACE(org_name, CHAR(160), '')),\n      TRIM(REPLACE(eat_name, CHAR(160), '')),\n      TRIM(REPLACE(asset_name, CHAR(160), '')),\n      TRIM(REPLACE(ind_code, CHAR(160), ''))\n    )) as hub_ind_bk_lower,\n    MD5(LOWER(CONCAT_WS('|',\n      TRIM(REPLACE(unit_name, CHAR(160), '')),\n      TRIM(REPLACE(data_type, CHAR(160), '')),\n      TRIM(REPLACE(discreteness, CHAR(160), '')),\n      TRIM(REPLACE(value_type, CHAR(160), '')),\n      TRIM(REPLACE(org_name, CHAR(160), '')),\n      TRIM(REPLACE(eat_name, CHAR(160), '')),\n      TRIM(REPLACE(asset_name, CHAR(160), '')),\n      TRIM(REPLACE(ind_code, CHAR(160), ''))\n    ))) as hub_ind_pk,\n    period_dt,\n    report_date,\n    load_dttm,\n    source_nm\n  FROM source_data\n),\n\nfact_data AS (\n  SELECT\n    \n  MD5(\n    CONCAT_WS('|', \n      TRIM(REPLACE(COALESCE(CAST(hub_ind_pk AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(period_dt AS CHAR) AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(report_date AS CHAR) AS CHAR), ''), CHAR(160), ''))\n    )\n  )\n as hub_fact_pk,\n    hub_ind_pk as bk_hub_ind_pk,\n    period_dt as bk_period_dt,\n    report_date as bk_report_date,\n    load_dttm,\n    source_nm\n  FROM normalized_data\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_fact_pk,\n    bk_hub_ind_pk,\n    bk_period_dt,\n    bk_report_date,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM fact_data\n  GROUP BY hub_fact_pk, bk_hub_ind_pk, bk_period_dt, bk_report_date\n)\n\nSELECT\n  hub_fact_pk,\n  bk_hub_ind_pk,\n  bk_period_dt,\n  bk_report_date,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs\nLIMIT 25000", "relation_name": "`unverified`.`hub_rdv__fact`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:52.198028Z", "completed_at": "2025-12-09T10:55:52.206077Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:52.206551Z", "completed_at": "2025-12-09T10:55:53.426830Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2578551769256592, "adapter_response": {"_message": "SUCCESS 658", "code": "SUCCESS", "rows_affected": 658}, "message": "SUCCESS 658", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_ind", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439\n-- Business Key \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0438\u0437 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430: hub_unit_pk|hub_data_type_pk|hub_date_type_pk|hub_value_type_pk|hub_organization_pk|hub_economic_activity_type_pk|hub_asset_pk|ind_code\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    LOWER(s.hub_ind_bk) as hub_ind_bk_lower,  -- \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u043c BK \u043a lowercase \u0434\u043b\u044f \u0435\u0434\u0438\u043d\u043e\u0433\u043e \u043a\u043b\u044e\u0447\u0430\n    s.load_dttm,\n    s.source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.hub_ind_bk IS NOT NULL\n  \n),\n\nhub_data AS (\n  SELECT\n    MD5(s.hub_ind_bk_lower) as hub_ind_pk,  -- hash \u0438\u0437 lowercase BK\n    s.hub_ind_bk_lower as hub_ind_bk,       -- \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c BK \u0432 lowercase\n    s.load_dttm,\n    s.source_nm\n  FROM source_data s\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM hub_data\n  GROUP BY hub_ind_pk, hub_ind_bk\n)\n\nSELECT\n  hub_ind_pk,\n  hub_ind_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs\nLIMIT 25000", "relation_name": "`unverified`.`hub_rdv__ind`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:53.463150Z", "completed_at": "2025-12-09T10:55:53.469997Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:53.470369Z", "completed_at": "2025-12-09T10:55:54.564553Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1398131847381592, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_metric", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 \"\u041c\u0435\u0442\u0440\u0438\u043a\u0430\"\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    metric as hub_metric_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE metric IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_metric_bk_raw, CHAR(160), ''))) as hub_metric_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_metric_bk) as hub_metric_pk, -- hash \u0438\u0437 lowercase BK\n    hub_metric_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    metric as hub_metric_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE metric IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_metric_bk_raw, CHAR(160), ''))) as hub_metric_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_metric_bk) as hub_metric_pk, -- hash \u0438\u0437 lowercase BK\n    hub_metric_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_metric_pk,\n    hub_metric_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_metric_pk, hub_metric_bk\n)\n\nSELECT\n  hub_metric_pk,\n  hub_metric_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__metric`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:54.608566Z", "completed_at": "2025-12-09T10:55:54.617234Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:54.617760Z", "completed_at": "2025-12-09T10:55:56.034067Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4556710720062256, "adapter_response": {"_message": "SUCCESS 115", "code": "SUCCESS", "rows_affected": 115}, "message": "SUCCESS 115", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_organization", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0439\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    org_name as hub_organization_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE org_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_organization_bk_raw, CHAR(160), ''))) as hub_organization_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_organization_bk) as hub_organization_pk, -- hash \u0438\u0437 lowercase BK\n    hub_organization_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    org_name as hub_organization_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE org_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_organization_bk_raw, CHAR(160), ''))) as hub_organization_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_organization_bk) as hub_organization_pk, -- hash \u0438\u0437 lowercase BK\n    hub_organization_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_organization_pk,\n    hub_organization_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_organization_pk, hub_organization_bk\n)\n\nSELECT\n  hub_organization_pk,\n  hub_organization_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__organization`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:56.068394Z", "completed_at": "2025-12-09T10:55:56.074915Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:56.075313Z", "completed_at": "2025-12-09T10:55:57.070455Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.0291647911071777, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_unit", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0435\u0434\u0438\u043d\u0438\u0446 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    unit_name as hub_unit_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE unit_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_unit_bk_raw, CHAR(160), ''))) as hub_unit_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_unit_bk) as hub_unit_pk, -- hash \u0438\u0437 lowercase BK\n    hub_unit_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    unit_name as hub_unit_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE unit_name IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_unit_bk_raw, CHAR(160), ''))) as hub_unit_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_unit_bk) as hub_unit_pk, -- hash \u0438\u0437 lowercase BK\n    hub_unit_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_unit_pk,\n    hub_unit_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_unit_pk, hub_unit_bk\n)\n\nSELECT\n  hub_unit_pk,\n  hub_unit_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__unit`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:57.099468Z", "completed_at": "2025-12-09T10:55:57.103344Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:57.103609Z", "completed_at": "2025-12-09T10:55:58.096259Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.02634596824646, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.proekt_shablon_1.hub_rdv_value_type", "compiled": true, "compiled_code": "\n\n-- Hub \u0434\u043b\u044f \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 \"\u0422\u0438\u043f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\"\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\nWITH form_1_staging AS (\n  SELECT DISTINCT\n    value_type as hub_value_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE value_type IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_1'\n  \n),\n\nform_1_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_value_type_bk_raw, CHAR(160), ''))) as hub_value_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_1_staging\n),\n\nform_1_hub AS (\n  SELECT\n    MD5(hub_value_type_bk) as hub_value_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_value_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_1_normalized\n),\n\nform_2_staging AS (\n  SELECT DISTINCT\n    value_type as hub_value_type_bk_raw,\n    load_dttm,\n    source_nm\n  FROM t1_stage.stg_source_data_new\n  WHERE value_type IS NOT NULL\n    AND source_nm = 'raw.accounting_balance_form_2'\n  \n),\n\nform_2_normalized AS (\n  SELECT\n    LOWER(TRIM(REPLACE(hub_value_type_bk_raw, CHAR(160), ''))) as hub_value_type_bk, -- BK \u0432 lowercase\n    load_dttm,\n    source_nm\n  FROM form_2_staging\n),\n\nform_2_hub AS (\n  SELECT\n    MD5(hub_value_type_bk) as hub_value_type_pk, -- hash \u0438\u0437 lowercase BK\n    hub_value_type_bk,\n    load_dttm,\n    source_nm\n  FROM form_2_normalized\n),\n\nall_hubs AS (\n  SELECT * FROM form_1_hub\n  UNION ALL\n  SELECT * FROM form_2_hub\n),\n\ndeduplicated_hubs AS (\n  SELECT\n    hub_value_type_pk,\n    hub_value_type_bk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM all_hubs\n  GROUP BY hub_value_type_pk, hub_value_type_bk\n)\n\nSELECT\n  hub_value_type_pk,\n  hub_value_type_bk,\n  load_dttm,\n  source_nm\nFROM deduplicated_hubs", "relation_name": "`unverified`.`hub_rdv__value_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:58.129687Z", "completed_at": "2025-12-09T10:55:58.137658Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:58.138061Z", "completed_at": "2025-12-09T10:55:59.511802Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.412769079208374, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.stg_source_data", "compiled": true, "compiled_code": "\n\n-- Staging \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u043b\u044f \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 form_1 \u0438 form_2\n-- \u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0438\u0437 t1_stage\n\nWITH form_1 AS (\n  SELECT\n    `\u0410\u041a\u0422\u0418\u0412` as asset_name,\n    CAST(`\u041a\u043e\u0434_\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f` AS VARCHAR) as ind_code,\n    `\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435` as value_current_year,\n    `\u041f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u0422\u0438\u043f_\u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    REPLACE(\n      REPLACE(\n        TRIM(`\u0412\u0438\u0434_\u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439_\u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438`),\n        '\u043c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n        '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n      ),\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n    ) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430_\u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    `\u0422\u0438\u043f_\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f` as value_type,\n    REPLACE(`\u0422\u0438\u043f_\u0434\u0430\u043d\u043d\u044b\u0445`, '\u0423\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439', '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439') as data_type,\n    `\u041c\u0435\u0442\u0440\u0438\u043a\u0430` as metric,\n    REPLACE(`\u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c`, '\u041a\u0432\u0430\u0440\u0442\u0430\u043b', '\u043a\u0432\u0430\u0440\u0442\u0430\u043b') as discreteness,\n    `\u041a\u0432\u0430\u0440\u0442\u0430\u043b` as quarter,\n    `\u0413\u043e\u0434` as year,\n    now() as load_dttm,\n    'raw.accounting_balance_form_1' as source_nm\n  FROM t1_stage.financial_\u0424\u043e\u0440\u043c\u0430_1_xls_rzdm_dev_buinu_sys_bucket\n),\n\nform_2 AS (\n  SELECT\n    `\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435_\u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f` as asset_name,\n    CAST(`\u041a\u043e\u0434` AS VARCHAR) as ind_code,\n    `\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435` as value_current_year,\n    `\u041f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u0422\u0438\u043f_\u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    REPLACE(\n      REPLACE(\n        TRIM(`\u0412\u0438\u0434_\u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439_\u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438`),\n        '\u043c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n        '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n      ),\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n    ) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430_\u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    `\u0422\u0438\u043f_\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f` as value_type,\n    REPLACE(`\u0422\u0438\u043f_\u0434\u0430\u043d\u043d\u044b\u0445`, '\u0423\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439', '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439') as data_type,\n    `\u041c\u0435\u0442\u0440\u0438\u043a\u0430` as metric,\n    REPLACE(`\u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c`, '\u041a\u0432\u0430\u0440\u0442\u0430\u043b', '\u043a\u0432\u0430\u0440\u0442\u0430\u043b') as discreteness,\n    `\u041a\u0432\u0430\u0440\u0442\u0430\u043b` as quarter,\n    `\u0413\u043e\u0434` as year,\n    now() as load_dttm,\n    'raw.accounting_balance_form_2' as source_nm\n  FROM t1_stage.financial_\u0424\u043e\u0440\u043c\u0430_2_xls_rzdm_dev_buinu_sys_bucket\n),\n\nunified_data AS (\n  SELECT \n    asset_name,\n    ind_code,\n    value_current_year,\n    period_text,\n    report_type,\n    org_name,\n    eat_name,\n    unit_name,\n    value_type,\n    data_type,\n    metric,\n    discreteness,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM form_1\n\n  UNION ALL\n\n  SELECT \n    asset_name,\n    ind_code,\n    value_current_year,\n    period_text,\n    report_type,\n    org_name,\n    eat_name,\n    unit_name,\n    value_type,\n    data_type,\n    metric,\n    discreteness,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM form_2\n),\n\n-- \u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e\u043b\u0435\u0439 \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c CHAR(160) \u0438 TRIM\nnormalized_data AS (\n  SELECT\n    asset_name,\n    ind_code,\n    value_current_year,\n    period_text,\n    report_type,\n    TRIM(REPLACE(org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(metric, CHAR(160), '')) as metric_norm,\n    TRIM(REPLACE(discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(ind_code, CHAR(160), '')) as ind_code_norm,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM unified_data\n  WHERE unit_name IS NOT NULL \n    AND data_type IS NOT NULL\n    AND discreteness IS NOT NULL\n    AND value_type IS NOT NULL\n    AND org_name IS NOT NULL \n    AND eat_name IS NOT NULL \n    AND asset_name IS NOT NULL\n    AND ind_code IS NOT NULL\n)\n\nSELECT\n  ind_code_norm as ind_code,\n  asset_name_norm as asset_name,\n  value_current_year,\n  period_text,\n  report_type,\n  org_name_norm as org_name,\n  eat_name_norm as eat_name,\n  unit_name_norm as unit_name,\n  value_type_norm as value_type,\n  data_type_norm as data_type,\n  metric_norm as metric,\n  discreteness_norm as discreteness,\n  quarter,\n  year,\n  load_dttm,\n  source_nm,\n  -- \u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 hub_ind_bk\n  -- \u0423\u0431\u0440\u0430\u043b\u0438 CAST, \u0442\u0430\u043a \u043a\u0430\u043a StarRocks \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 CHARACTER SET \u0432 CAST\n  CONCAT_WS('|',\n    unit_name_norm,\n    data_type_norm,\n    discreteness_norm,\n    value_type_norm,\n    org_name_norm,\n    eat_name_norm,\n    asset_name_norm,\n    ind_code_norm\n  ) as hub_ind_bk\nFROM normalized_data\nLIMIT 1000  -- TEMP: \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0437 \u0441\u0442\u0435\u0439\u0434\u0436\u0430", "relation_name": "`stage`.`stg_source_data`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:55:59.547695Z", "completed_at": "2025-12-09T10:55:59.558169Z"}, {"name": "execute", "started_at": "2025-12-09T10:55:59.558582Z", "completed_at": "2025-12-09T10:56:00.967627Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.4481160640716553, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.stg_source_data_new", "compiled": true, "compiled_code": "\n\n-- \u041d\u043e\u0432\u0430\u044f staging \u043c\u043e\u0434\u0435\u043b\u044c \u0434\u043b\u044f \u043e\u0431\u044a\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u044f \u0434\u0430\u043d\u043d\u044b\u0445 \u0438\u0437 form_1 \u0438 form_2\n-- \u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0438 \u0438\u0437 stg_buinu\n-- \u0412\u0410\u0416\u041d\u041e: \u042d\u0442\u0430 \u043c\u043e\u0434\u0435\u043b\u044c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0438 \u0431\u0443\u0434\u0435\u0442 \u0434\u043e\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0442\u044c\u0441\u044f\n-- \u0434\u043e \u043f\u043e\u043b\u043d\u043e\u0439 \u0438\u0434\u0435\u043d\u0442\u0438\u0447\u043d\u043e\u0441\u0442\u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u0441 stg_source_data\n\n-- FORM 1: \u0422\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0442\u0440\u0435\u0445 \u043f\u043e\u043b\u0435\u0439 (\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434, \u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430, \u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u043e\u0437\u0430\u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430)\n-- \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043f\u043e\u043b\u0435\u043c \"\u041f\u0440\u0438\u0437\u043d\u0430\u043a \u043f\u0435\u0440\u0438\u043e\u0434\u0430\"\nWITH form_1 AS (\n  SELECT\n    `\u0410\u041a\u0422\u0418\u0412` as asset_name,\n    CAST(`\u041a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f` AS VARCHAR) as ind_code,\n    `\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434` as value_current_year,\n    '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' as period_indicator,\n    `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    REPLACE(\n      REPLACE(\n        TRIM(`\u0412\u0438\u0434 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438`),\n        '\u043c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n        '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n      ),\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n    ) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    -- \u0422\u0438\u043f_\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f = '\u0418\u0442\u043e\u0433' (\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430)\n    '\u0418\u0442\u043e\u0433' as value_type,\n    -- \u0422\u0438\u043f_\u0434\u0430\u043d\u043d\u044b\u0445 = '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' (\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430)\n           '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' as data_type,\n           -- \u041c\u0435\u0442\u0440\u0438\u043a\u0430 = '\u0424\u0430\u043a\u0442' (\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430)\n           '\u0424\u0430\u043a\u0442' as metric,\n           -- \u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c: '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0435\u0441\u044f\u0446\u044b/\u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b \u0418 (period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0418\u041b\u0418 form_2), \u0438\u043d\u0430\u0447\u0435 '\u0433\u043e\u0434'\n           CASE\n             WHEN (`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043a\u0432\u0430\u0440\u0442\u0430\u043b%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446\u0435\u0432%')\n               THEN '\u043a\u0432\u0430\u0440\u0442\u0430\u043b'  -- period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e SELECT\n             ELSE '\u0433\u043e\u0434'\n           END as discreteness,\n    -- \u041a\u0432\u0430\u0440\u0442\u0430\u043b: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b \u2192 1, 6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 2, 9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 3, \u0438\u043d\u0430\u0447\u0435 \u2192 4)\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b%' THEN 1\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 2\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 3\n      ELSE 4\n    END as quarter,\n    -- \u0413\u043e\u0434: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (2025 \u0433. \u2192 2025)\n    CAST(SUBSTRING_INDEX(SUBSTRING_INDEX(`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434`, ' ', -2), ' ', 1) AS BIGINT) as year,\n    now() as load_dttm,\n    -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438\n    CASE\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 1%' THEN 'raw.accounting_balance_form_1'\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 2%' THEN 'raw.accounting_balance_form_2'\n      ELSE file_name\n    END as source_nm\n  FROM stg_buinu.form_1_assets\n  WHERE `\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434` IS NOT NULL\n\n  UNION ALL\n\n  SELECT\n    `\u0410\u041a\u0422\u0418\u0412` as asset_name,\n    CAST(`\u041a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f` AS VARCHAR) as ind_code,\n    `\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` as value_current_year,\n    '\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430' as period_indicator,\n    `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    REPLACE(\n      REPLACE(\n        TRIM(`\u0412\u0438\u0434 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438`),\n        '\u043c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n        '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n      ),\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n    ) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    '\u0418\u0442\u043e\u0433' as value_type,\n    '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' as data_type,\n    '\u0424\u0430\u043a\u0442' as metric,\n    -- \u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c: '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0435\u0441\u044f\u0446\u044b/\u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b \u0418 (period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0418\u041b\u0418 form_2), \u0438\u043d\u0430\u0447\u0435 '\u0433\u043e\u0434'\n    '\u0433\u043e\u0434' as discreteness,  -- period_indicator = '\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430' (\u043d\u0435 '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0438 \u043d\u0435 form_2)\n    -- \u041a\u0432\u0430\u0440\u0442\u0430\u043b: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b \u2192 1, 6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 2, 9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 3, \u0438\u043d\u0430\u0447\u0435 \u2192 4)\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b%' THEN 1\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 2\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 3\n      ELSE 4\n    END as quarter,\n    -- \u0413\u043e\u0434: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (2025 \u0433. \u2192 2025)\n    CAST(SUBSTRING_INDEX(SUBSTRING_INDEX(`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434`, ' ', -2), ' ', 1) AS BIGINT) as year,\n    now() as load_dttm,\n    -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438\n    CASE\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 1%' THEN 'raw.accounting_balance_form_1'\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 2%' THEN 'raw.accounting_balance_form_2'\n      ELSE file_name\n    END as source_nm\n  FROM stg_buinu.form_1_assets\n  WHERE `\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` IS NOT NULL\n\n  UNION ALL\n\n  SELECT\n    `\u0410\u041a\u0422\u0418\u0412` as asset_name,\n    CAST(`\u041a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f` AS VARCHAR) as ind_code,\n    `\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u043e\u0437\u0430\u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` as value_current_year,\n    '\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u043e\u0437\u0430\u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430' as period_indicator,\n    `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    REPLACE(\n      REPLACE(\n        TRIM(`\u0412\u0438\u0434 \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438`),\n        '\u043c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n        '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n      ),\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0430',\n      '\u041c\u0435\u0434\u0438\u0446\u0438\u043d\u0441\u043a\u0430\u044f \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c'\n    ) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    '\u0418\u0442\u043e\u0433' as value_type,\n    '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' as data_type,\n    '\u0424\u0430\u043a\u0442' as metric,\n    -- \u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c: '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0435\u0441\u044f\u0446\u044b/\u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b \u0418 (period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0418\u041b\u0418 form_2), \u0438\u043d\u0430\u0447\u0435 '\u0433\u043e\u0434'\n    '\u0433\u043e\u0434' as discreteness,  -- period_indicator = '\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u043e\u0437\u0430\u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430' (\u043d\u0435 '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0438 \u043d\u0435 form_2)\n    -- \u041a\u0432\u0430\u0440\u0442\u0430\u043b: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b \u2192 1, 6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 2, 9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 3, \u0438\u043d\u0430\u0447\u0435 \u2192 4)\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b%' THEN 1\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 2\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 3\n      ELSE 4\n    END as quarter,\n    -- \u0413\u043e\u0434: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (2025 \u0433. \u2192 2025)\n    CAST(SUBSTRING_INDEX(SUBSTRING_INDEX(`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434`, ' ', -2), ' ', 1) AS BIGINT) as year,\n    now() as load_dttm,\n    -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438\n    CASE\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 1%' THEN 'raw.accounting_balance_form_1'\n      WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 2%' THEN 'raw.accounting_balance_form_2'\n      ELSE file_name\n    END as source_nm\n  FROM stg_buinu.form_1_assets\n  WHERE `\u041d\u0430 31 \u0434\u0435\u043a\u0430\u0431\u0440\u044f \u043f\u043e\u0437\u0430\u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` IS NOT NULL\n),\n\n-- FORM 2: \u0422\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u0434\u0432\u0443\u0445 \u043f\u043e\u043b\u0435\u0439 (\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434, \u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430)\n-- \u0432 \u043e\u0442\u0434\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u043f\u043e\u043b\u0435\u043c \"\u041f\u0440\u0438\u0437\u043d\u0430\u043a \u043f\u0435\u0440\u0438\u043e\u0434\u0430\"\nform_2 AS (\n  SELECT\n    `\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c` as asset_name,\n    CAST(`\u041a\u043e\u0434` AS VARCHAR) as ind_code,\n    `\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as value_current_year,\n    '\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' as period_indicator,\n    `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    CAST(NULL AS VARCHAR(500)) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    -- \u0422\u0438\u043f_\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f: \u0435\u0441\u043b\u0438 period_text \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0433\u043e\u0434 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \"2024 \u0433.\"), \u0442\u043e '\u0418\u0442\u043e\u0433', \u0438\u043d\u0430\u0447\u0435 '\u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430'\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043a\u0432\u0430\u0440\u0442\u0430\u043b%' \n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043c\u0435\u0441\u044f\u0446%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043c\u0435\u0441\u044f\u0446\u0435\u0432%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043f\u043e\u043b\u0443\u0433\u043e\u0434\u0438\u0435%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u0441\u0443\u0442\u043a\u0438%'\n        THEN '\u0418\u0442\u043e\u0433'\n      ELSE '\u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430'\n    END as value_type,\n           -- \u0422\u0438\u043f_\u0434\u0430\u043d\u043d\u044b\u0445 = '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' (\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430)\n           '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' as data_type,\n           -- \u041c\u0435\u0442\u0440\u0438\u043a\u0430 = '\u0424\u0430\u043a\u0442' (\u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u0430)\n           '\u0424\u0430\u043a\u0442' as metric,\n           -- \u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c: '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0435\u0441\u044f\u0446\u044b/\u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b \u0418 (period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0418\u041b\u0418 form_2), \u0438\u043d\u0430\u0447\u0435 '\u0433\u043e\u0434'\n           CASE\n             WHEN (`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043a\u0432\u0430\u0440\u0442\u0430\u043b%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446\u0435\u0432%')\n               THEN '\u043a\u0432\u0430\u0440\u0442\u0430\u043b'  -- form_2 \u0432\u0441\u0435\u0433\u0434\u0430 '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b/\u043c\u0435\u0441\u044f\u0446\u044b\n             ELSE '\u0433\u043e\u0434'\n           END as discreteness,\n           -- \u041a\u0432\u0430\u0440\u0442\u0430\u043b: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b \u2192 1, 6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 2, 9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 3, \u0438\u043d\u0430\u0447\u0435 \u2192 4)\n           CASE\n             WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b%' THEN 1\n             WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 2\n             WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 3\n             ELSE 4\n           END as quarter,\n           -- \u0413\u043e\u0434: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (2025 \u0433. \u2192 2025)\n           CAST(SUBSTRING_INDEX(SUBSTRING_INDEX(`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434`, ' ', -2), ' ', 1) AS BIGINT) as year,\n           now() as load_dttm,\n           -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438\n           CASE\n             WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 1%' THEN 'raw.accounting_balance_form_1'\n             WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 2%' THEN 'raw.accounting_balance_form_2'\n             ELSE file_name\n           END as source_nm\n         FROM stg_buinu.form_2_financial\n         WHERE `\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` IS NOT NULL\n\n  UNION ALL\n\n  SELECT\n    `\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c` as asset_name,\n    CAST(`\u041a\u043e\u0434` AS VARCHAR) as ind_code,\n    `\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` as value_current_year,\n    '\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430' as period_indicator,\n    `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` as period_text,\n    `\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0442\u0447\u0435\u0442\u0430` as report_type,\n    `\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f` as org_name,\n    CAST(NULL AS VARCHAR(500)) as eat_name,\n    `\u0415\u0434\u0435\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f` as unit_name,\n    -- \u0422\u0438\u043f_\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f: \u0435\u0441\u043b\u0438 period_text \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0433\u043e\u0434 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \"2024 \u0433.\"), \u0442\u043e '\u0418\u0442\u043e\u0433', \u0438\u043d\u0430\u0447\u0435 '\u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430'\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043a\u0432\u0430\u0440\u0442\u0430\u043b%' \n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043c\u0435\u0441\u044f\u0446%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043c\u0435\u0441\u044f\u0446\u0435\u0432%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u043f\u043e\u043b\u0443\u0433\u043e\u0434\u0438\u0435%'\n        AND `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` NOT LIKE '%\u0441\u0443\u0442\u043a\u0438%'\n        THEN '\u0418\u0442\u043e\u0433'\n      ELSE '\u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430'\n    END as value_type,\n    '\u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u043d\u044b\u0439' as data_type,\n    '\u0424\u0430\u043a\u0442' as metric,\n    -- \u0414\u0438\u0441\u043a\u0440\u0435\u0442\u043d\u043e\u0441\u0442\u044c: '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043c\u0435\u0441\u044f\u0446\u044b/\u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b \u0418 (period_indicator = '\u041d\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0433\u043e\u0434' \u0418\u041b\u0418 form_2), \u0438\u043d\u0430\u0447\u0435 '\u0433\u043e\u0434'\n    CASE\n      WHEN (`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043a\u0432\u0430\u0440\u0442\u0430\u043b%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446%' OR `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%\u043c\u0435\u0441\u044f\u0446\u0435\u0432%')\n        THEN '\u043a\u0432\u0430\u0440\u0442\u0430\u043b'  -- form_2 \u0432\u0441\u0435\u0433\u0434\u0430 '\u043a\u0432\u0430\u0440\u0442\u0430\u043b' \u0435\u0441\u043b\u0438 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u044b/\u043c\u0435\u0441\u044f\u0446\u044b\n      ELSE '\u0433\u043e\u0434'\n    END as discreteness,\n    -- \u041a\u0432\u0430\u0440\u0442\u0430\u043b: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b \u2192 1, 6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 2, 9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432 \u2192 3, \u0438\u043d\u0430\u0447\u0435 \u2192 4)\n    CASE\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%1 \u043a\u0432\u0430\u0440\u0442\u0430\u043b%' THEN 1\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%6 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 2\n      WHEN `\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434` LIKE '%9 \u043c\u0435\u0441\u044f\u0446\u0435\u0432%' THEN 3\n      ELSE 4\n    END as quarter,\n    -- \u0413\u043e\u0434: \u0438\u0437\u0432\u043b\u0435\u0447\u044c \u0438\u0437 '\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434' (2025 \u0433. \u2192 2025)\n           CAST(SUBSTRING_INDEX(SUBSTRING_INDEX(`\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0439 \u043f\u0435\u0440\u0438\u043e\u0434`, ' ', -2), ' ', 1) AS BIGINT) as year,\n           now() as load_dttm,\n           -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0434\u043b\u044f \u0441\u043e\u0432\u043c\u0435\u0441\u0442\u0438\u043c\u043e\u0441\u0442\u0438 \u0441 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u043c\u0438 \u043c\u043e\u0434\u0435\u043b\u044f\u043c\u0438\n           CASE\n             WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 1%' THEN 'raw.accounting_balance_form_1'\n             WHEN file_name LIKE '%\u0424\u043e\u0440\u043c\u0430 2%' THEN 'raw.accounting_balance_form_2'\n             ELSE file_name\n           END as source_nm\n         FROM stg_buinu.form_2_financial\n  WHERE `\u0417\u0430 \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0435\u0440\u0438\u043e\u0434 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430` IS NOT NULL\n),\n\nunified_data AS (\n  SELECT \n    asset_name,\n    ind_code,\n    value_current_year,\n    period_indicator,\n    period_text,\n    report_type,\n    org_name,\n    eat_name,\n    unit_name,\n    value_type,\n    data_type,\n    metric,\n    discreteness,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM form_2\n\n  UNION ALL\n\n  SELECT \n    asset_name,\n    ind_code,\n    value_current_year,\n    period_indicator,\n    period_text,\n    report_type,\n    org_name,\n    eat_name,\n    unit_name,\n    value_type,\n    data_type,\n    metric,\n    discreteness,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM form_1\n),\n\n-- \u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u043f\u043e\u043b\u0435\u0439 \u0441 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435\u043c CHAR(160) \u0438 TRIM\nnormalized_data AS (\n  SELECT\n    asset_name,\n    ind_code,\n    value_current_year,\n    period_indicator,\n    period_text,\n    report_type,\n    TRIM(REPLACE(org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(metric, CHAR(160), '')) as metric_norm,\n    TRIM(REPLACE(discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(ind_code, CHAR(160), '')) as ind_code_norm,\n    quarter,\n    year,\n    load_dttm,\n    source_nm\n  FROM unified_data\n  WHERE unit_name IS NOT NULL \n    AND org_name IS NOT NULL \n    AND asset_name IS NOT NULL\n    AND ind_code IS NOT NULL\n)\n\nSELECT\n  ind_code_norm as ind_code,\n  asset_name_norm as asset_name,\n  CAST(value_current_year AS DECIMAL(20,2)) as value_current_year,\n  period_indicator,\n  CAST(period_text AS VARCHAR(65533)) as period_text,\n  CAST(report_type AS VARCHAR(65533)) as report_type,\n  org_name_norm as org_name,\n  eat_name_norm as eat_name,\n  unit_name_norm as unit_name,\n  value_type_norm as value_type,\n  data_type_norm as data_type,\n  metric_norm as metric,\n  discreteness_norm as discreteness,\n  CAST(quarter AS BIGINT) as quarter,\n  year,\n  load_dttm,\n  -- \u041c\u0430\u043f\u043f\u0438\u043d\u0433 source_nm \u0443\u0436\u0435 \u043f\u0440\u0438\u043c\u0435\u043d\u0435\u043d \u0432 CTE, \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0440\u0438\u0432\u043e\u0434\u0438\u043c \u043a \u043d\u0443\u0436\u043d\u043e\u043c\u0443 \u0442\u0438\u043f\u0443\n  CAST(source_nm AS VARCHAR(1048576)) as source_nm,\n  -- \u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 hub_ind_bk\n  -- \u0412\u0410\u0416\u041d\u041e: \u041f\u043e\u043a\u0430 \u043d\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u044b, hub_ind_bk \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043d\u0435\u043f\u043e\u043b\u043d\u044b\u043c\n  CONCAT_WS('|',\n    unit_name_norm,\n    data_type_norm,\n    discreteness_norm,\n    value_type_norm,\n    org_name_norm,\n    eat_name_norm,\n    asset_name_norm,\n    ind_code_norm\n  ) as hub_ind_bk\nFROM normalized_data\nLIMIT 1000  -- TEMP: \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u0438\u0435 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0438\u0437 \u0441\u0442\u0435\u0439\u0434\u0436\u0430", "relation_name": "`stage`.`stg_source_data_new`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:01.002691Z", "completed_at": "2025-12-09T10:56:01.011366Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:01.011737Z", "completed_at": "2025-12-09T10:56:02.099601Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1248300075531006, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_fact", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0444\u0430\u043a\u0442\u043e\u043c\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_fact_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH hub_fact_data AS (\n  SELECT\n    hub_fact_pk,\n    bk_hub_ind_pk as hub_ind_pk,\n    load_dttm,\n    source_nm\n  FROM `unverified`.`hub_rdv__fact`\n  \n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_fact_pk AS CHAR))) as link_ind_fact_pk,\n    hub_ind_pk,\n    hub_fact_pk,\n    load_dttm,\n    source_nm\n  FROM hub_fact_data\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_fact_pk,\n    hub_ind_pk,\n    hub_fact_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_fact_pk, hub_ind_pk, hub_fact_pk\n)\n\nSELECT\n  link_ind_fact_pk,\n  hub_ind_pk,\n  hub_fact_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_fact`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:02.129004Z", "completed_at": "2025-12-09T10:56:02.134389Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:02.134668Z", "completed_at": "2025-12-09T10:56:03.312562Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2131271362304688, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_accounting_fin_indicator", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0443\u0447\u0435\u0442\u043d\u043e-\u0444\u0438\u043d\u0430\u043d\u0441\u043e\u0432\u044b\u043c \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_accounting_fin_indicator_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(COALESCE(CAST(s.metric AS CHAR), ''), CHAR(160), '')) as metric_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    s.load_dttm,\n    s.source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.unit_name IS NOT NULL \n    AND s.data_type IS NOT NULL\n    AND s.metric IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n    AND s.ind_code IS NOT NULL\n  \n),\n\nhub_ind_data AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    source_nm\n  FROM `unverified`.`hub_rdv__ind`\n),\n\nhub_afi_data AS (\n  SELECT\n    hub_accounting_fin_indicator_pk,\n    hub_accounting_fin_indicator_bk,\n    source_nm\n  FROM `unverified`.`hub_rdv__accounting_fin_indicator`\n),\n\nsource_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    hafi.hub_accounting_fin_indicator_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM source_data s\n  INNER JOIN hub_ind_data hi ON \n    CONCAT_WS('|',\n      s.unit_name_norm,\n      s.data_type_norm,\n      s.discreteness_norm,\n      s.value_type_norm,\n      s.org_name_norm,\n      s.eat_name_norm,\n      s.asset_name_norm,\n      s.ind_code_norm\n    ) = hi.hub_ind_bk\n    AND s.source_nm = hi.source_nm\n  INNER JOIN hub_afi_data hafi ON\n    CONCAT_WS('|',\n      s.unit_name_norm,\n      s.data_type_norm,\n      s.metric_norm,\n      s.discreteness_norm,\n      s.value_type_norm,\n      s.org_name_norm,\n      s.eat_name_norm,\n      s.asset_name_norm,\n      s.ind_code_norm\n    ) = hafi.hub_accounting_fin_indicator_bk\n    AND s.source_nm = hafi.source_nm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_accounting_fin_indicator_pk AS CHAR))) as link_ind_accounting_fin_indicator_pk,\n    hub_ind_pk,\n    hub_accounting_fin_indicator_pk,\n    load_dttm,\n    source_nm\n  FROM source_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_accounting_fin_indicator_pk,\n    hub_ind_pk,\n    hub_accounting_fin_indicator_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_accounting_fin_indicator_pk, hub_ind_pk, hub_accounting_fin_indicator_pk\n)\n\nSELECT\n  link_ind_accounting_fin_indicator_pk,\n  hub_ind_pk,\n  hub_accounting_fin_indicator_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_accounting_fin_indicator`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:03.347593Z", "completed_at": "2025-12-09T10:56:03.356859Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:03.357363Z", "completed_at": "2025-12-09T10:56:04.828427Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.5112688541412354, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_asset", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0430\u043a\u0442\u0438\u0432\u043e\u043c\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_asset_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.asset_name IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_asset_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__asset` h ON h.hub_asset_bk = s.asset_name_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_asset_pk AS CHAR))) as link_ind_asset_pk,\n    hub_ind_pk,\n    hub_asset_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_asset_pk,\n    hub_ind_pk,\n    hub_asset_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_asset_pk, hub_ind_pk, hub_asset_pk\n)\n\nSELECT\n  link_ind_asset_pk,\n  hub_ind_pk,\n  hub_asset_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_asset`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:04.864383Z", "completed_at": "2025-12-09T10:56:04.871732Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:04.872288Z", "completed_at": "2025-12-09T10:56:06.229450Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.394834041595459, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_data_type", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0442\u0438\u043f\u043e\u043c \u0434\u0430\u043d\u043d\u044b\u0445\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_data_type_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_data_type_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__data_type` h ON h.hub_data_type_bk = s.data_type_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_data_type_pk AS CHAR))) as link_ind_data_type_pk,\n    hub_ind_pk,\n    hub_data_type_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_data_type_pk,\n    hub_ind_pk,\n    hub_data_type_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_data_type_pk, hub_ind_pk, hub_data_type_pk\n)\n\nSELECT\n  link_ind_data_type_pk,\n  hub_ind_pk,\n  hub_data_type_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_data_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:06.263660Z", "completed_at": "2025-12-09T10:56:06.272834Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:06.273322Z", "completed_at": "2025-12-09T10:56:07.508285Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.276968240737915, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_date_type", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0442\u0438\u043f\u043e\u043c \u0434\u0430\u0442\u044b\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_date_type_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_date_type_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__date_type` h ON h.hub_date_type_bk = s.discreteness_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_date_type_pk AS CHAR))) as link_ind_date_type_pk,\n    hub_ind_pk,\n    hub_date_type_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_date_type_pk,\n    hub_ind_pk,\n    hub_date_type_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_date_type_pk, hub_ind_pk, hub_date_type_pk\n)\n\nSELECT\n  link_ind_date_type_pk,\n  hub_ind_pk,\n  hub_date_type_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_date_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:07.552327Z", "completed_at": "2025-12-09T10:56:07.561188Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:07.561584Z", "completed_at": "2025-12-09T10:56:08.812242Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2955842018127441, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_economic_activity_type", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0432\u0438\u0434\u043e\u043c \u044d\u043a\u043e\u043d\u043e\u043c\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_economic_activity_type_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.eat_name IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_economic_activity_type_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__economic_activity_type` h ON h.hub_economic_activity_type_bk = s.eat_name_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_economic_activity_type_pk AS CHAR))) as link_ind_economic_activity_type_pk,\n    hub_ind_pk,\n    hub_economic_activity_type_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_economic_activity_type_pk,\n    hub_ind_pk,\n    hub_economic_activity_type_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_economic_activity_type_pk, hub_ind_pk, hub_economic_activity_type_pk\n)\n\nSELECT\n  link_ind_economic_activity_type_pk,\n  hub_ind_pk,\n  hub_economic_activity_type_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_economic_activity_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:08.846866Z", "completed_at": "2025-12-09T10:56:08.856710Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:08.857197Z", "completed_at": "2025-12-09T10:56:10.182757Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.366109848022461, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.sat_rdv_fact", "compiled": true, "compiled_code": "\n\n-- Satellite \u0434\u043b\u044f \u0444\u0430\u043a\u0442\u043e\u0432\n-- \u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b \u0444\u0430\u043a\u0442\u0430: \u043f\u0435\u0440\u0438\u043e\u0434, \u0434\u0430\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    s.unit_name,\n    s.data_type,\n    s.discreteness,\n    s.value_type,\n    s.org_name,\n    s.eat_name,\n    s.asset_name,\n    s.ind_code,\n    s.year,\n    s.quarter,\n    DATE(s.load_dttm) as load_date,\n    s.load_dttm,\n    s.source_nm,\n    \n  CASE \n    WHEN s.quarter = 1 THEN STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n    WHEN s.quarter = 2 THEN STR_TO_DATE(CONCAT(s.year, '-04-01'), '%Y-%m-%d')\n    WHEN s.quarter = 3 THEN STR_TO_DATE(CONCAT(s.year, '-07-01'), '%Y-%m-%d')\n    WHEN s.quarter = 4 THEN STR_TO_DATE(CONCAT(s.year, '-10-01'), '%Y-%m-%d')\n    ELSE STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n  END\n as period_dt\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.year IS NOT NULL\n    AND s.quarter IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n),\n\nsource_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    s.year,\n    s.quarter,\n    s.load_date,\n    s.load_dttm,\n    s.source_nm,\n    s.period_dt\n  FROM source_data s\n),\n\nhub_ind_data AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    source_nm\n  FROM `unverified`.`hub_rdv__ind`\n),\n\nsource_with_hub_ind AS (\n  SELECT\n    h.hub_ind_pk,\n    s.year,\n    s.quarter,\n    s.load_date,\n    s.load_dttm,\n    s.source_nm,\n    s.period_dt\n  FROM source_normalized s\n  INNER JOIN hub_ind_data h ON \n    LOWER(CONCAT_WS('|',\n      s.unit_name_norm,\n      s.data_type_norm,\n      s.discreteness_norm,\n      s.value_type_norm,\n      s.org_name_norm,\n      s.eat_name_norm,\n      s.asset_name_norm,\n      s.ind_code_norm\n    )) = h.hub_ind_bk  -- hub \u0445\u0440\u0430\u043d\u0438\u0442 BK \u0432 lowercase\n    AND s.source_nm = h.source_nm\n),\n\nhub_fact_data AS (\n  SELECT\n    hub_fact_pk,\n    bk_hub_ind_pk,\n    bk_period_dt,\n    bk_report_date,\n    source_nm\n  FROM `unverified`.`hub_rdv__fact`\n),\n\nsat_data AS (\n  SELECT\n    hf.hub_fact_pk,\n    s.period_dt,\n    s.load_date as report_date,\n    s.load_date,\n    s.source_nm\n  FROM source_with_hub_ind s\n  INNER JOIN hub_fact_data hf ON \n    s.hub_ind_pk = hf.bk_hub_ind_pk\n    AND s.period_dt = hf.bk_period_dt\n    AND s.load_date = hf.bk_report_date\n    AND s.source_nm = hf.source_nm\n)\n\nSELECT DISTINCT\n  hub_fact_pk,\n  load_date,\n  period_dt,\n  report_date,\n  source_nm\nFROM sat_data", "relation_name": "`unverified`.`sat_rdv__fact`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:10.218660Z", "completed_at": "2025-12-09T10:56:10.231249Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:10.231684Z", "completed_at": "2025-12-09T10:56:11.499586Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.308708667755127, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.sat_rdv_fact_value", "compiled": true, "compiled_code": "\n\n-- Satellite \u0434\u043b\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0444\u0430\u043a\u0442\u043e\u0432\n-- \u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b: \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    s.unit_name,\n    s.data_type,\n    s.discreteness,\n    s.value_type,\n    s.org_name,\n    s.eat_name,\n    s.asset_name,\n    s.ind_code,\n    s.year,\n    s.quarter,\n    s.value_current_year,\n    DATE(s.load_dttm) as load_date,\n    s.load_dttm,\n    s.source_nm,\n    \n  CASE \n    WHEN s.quarter = 1 THEN STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n    WHEN s.quarter = 2 THEN STR_TO_DATE(CONCAT(s.year, '-04-01'), '%Y-%m-%d')\n    WHEN s.quarter = 3 THEN STR_TO_DATE(CONCAT(s.year, '-07-01'), '%Y-%m-%d')\n    WHEN s.quarter = 4 THEN STR_TO_DATE(CONCAT(s.year, '-10-01'), '%Y-%m-%d')\n    ELSE STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n  END\n as period_dt\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.value_current_year IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n    AND s.ind_code IS NOT NULL\n  \n),\n\nsource_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    s.year,\n    s.quarter,\n    s.value_current_year,\n    s.load_date,\n    s.load_dttm,\n    s.source_nm,\n    s.period_dt\n  FROM source_data s\n),\n\nhub_ind_data AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    source_nm\n  FROM `unverified`.`hub_rdv__ind`\n),\n\nsource_with_hub_ind AS (\n  SELECT\n    h.hub_ind_pk,\n    s.year,\n    s.quarter,\n    s.value_current_year,\n    s.load_date,\n    s.load_dttm,\n    s.source_nm,\n    s.period_dt\n  FROM source_normalized s\n  INNER JOIN hub_ind_data h ON \n    LOWER(CONCAT_WS('|',\n      s.unit_name_norm,\n      s.data_type_norm,\n      s.discreteness_norm,\n      s.value_type_norm,\n      s.org_name_norm,\n      s.eat_name_norm,\n      s.asset_name_norm,\n      s.ind_code_norm\n    )) = h.hub_ind_bk  -- hub \u0445\u0440\u0430\u043d\u0438\u0442 BK \u0432 lowercase\n    AND s.source_nm = h.source_nm\n),\n\nhub_fact_data AS (\n  SELECT\n    hub_fact_pk,\n    bk_hub_ind_pk,\n    bk_period_dt,\n    bk_report_date,\n    source_nm\n  FROM `unverified`.`hub_rdv__fact`\n),\n\nsource_with_fact_pk AS (\n  SELECT\n    s.*,\n    hf.hub_fact_pk\n  FROM source_with_hub_ind s\n  INNER JOIN hub_fact_data hf ON \n    s.hub_ind_pk = hf.bk_hub_ind_pk\n    AND s.period_dt = hf.bk_period_dt\n    AND s.load_date = hf.bk_report_date\n    AND s.source_nm = hf.source_nm\n),\n\nrow_counts AS (\n  SELECT\n    source_nm,\n    COUNT(*) as file_row_number\n  FROM source_with_fact_pk\n  GROUP BY source_nm\n)\n\nSELECT DISTINCT\n  s.hub_fact_pk,\n  s.load_date,\n  s.value_current_year as value_amt,\n  s.source_nm,\n  rc.file_row_number,\n  CAST(NULL AS VARCHAR(100)) as file_code,\n  s.source_nm as file_name,\n  CAST(NULL AS VARCHAR(100)) as ind_source_name,\n  CAST(NULL AS VARCHAR(100)) as ind_model_code,\n  'rdv' as ind_model_name\nFROM source_with_fact_pk s\nCROSS JOIN row_counts rc\nWHERE s.source_nm = rc.source_nm", "relation_name": "`unverified`.`sat_rdv__fact_value`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:11.532286Z", "completed_at": "2025-12-09T10:56:11.539002Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:11.539384Z", "completed_at": "2025-12-09T10:56:12.860099Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.3566479682922363, "adapter_response": {"_message": "SUCCESS 658", "code": "SUCCESS", "rows_affected": 658}, "message": "SUCCESS 658", "failures": null, "unique_id": "model.proekt_shablon_1.sat_rdv_ind", "compiled": true, "compiled_code": "\n\n-- Satellite \u0434\u043b\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439 (hub_ind)\n-- \u0410\u0442\u0440\u0438\u0431\u0443\u0442\u044b \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f: name (\u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043f\u043e \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u0443 \u0438\u0437 \u0432\u0441\u0435\u0445 \u043f\u043e\u043b\u0435\u0439) \u0438 code (\u043a\u043e\u0434 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH source_data AS (\n  SELECT DISTINCT\n    s.unit_name,\n    s.data_type,\n    s.discreteness,\n    s.value_type,\n    s.org_name,\n    s.eat_name,\n    s.asset_name,\n    s.ind_code,\n    s.load_dttm,\n    s.source_nm,\n    \n  CONCAT_WS('|', \n    TRIM(REPLACE(COALESCE(CAST(s.unit_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.data_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.metric AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.discreteness AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.value_type AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.org_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.eat_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.asset_name AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.ind_code AS CHAR), ''), CHAR(160), ''))\n  )\n as name,\n    CONCAT_WS('|',\n      TRIM(REPLACE(COALESCE(CAST(s.unit_name AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.data_type AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.discreteness AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.value_type AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.org_name AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.eat_name AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.asset_name AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(s.ind_code AS CHAR), ''), CHAR(160), ''))\n    ) as hub_ind_bk\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.unit_name IS NOT NULL \n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n),\n\nhub_ind_data AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    source_nm\n  FROM `unverified`.`hub_rdv__ind`\n),\n\nsat_data AS (\n  SELECT\n    h.hub_ind_pk,\n    s.name,\n    s.ind_code as code,\n    s.load_dttm as valid_from,\n    CAST('9999-12-31 23:59:59' AS DATETIME) as valid_to,\n    s.load_dttm,\n    s.source_nm\n  FROM source_data s\n  INNER JOIN hub_ind_data h ON \n    LOWER(s.hub_ind_bk) = h.hub_ind_bk  -- hub \u0445\u0440\u0430\u043d\u0438\u0442 BK \u0432 lowercase, sat \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u043e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u0439 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\n    AND s.source_nm = h.source_nm\n)\n\nSELECT\n  hub_ind_pk,\n  load_dttm,\n  name,\n  code,\n  valid_from,\n  valid_to,\n  source_nm\nFROM (\n  SELECT\n    hub_ind_pk,\n    load_dttm,\n    name,\n    code,\n    valid_from,\n    valid_to,\n    source_nm,\n    ROW_NUMBER() OVER (PARTITION BY hub_ind_pk, load_dttm ORDER BY load_dttm DESC) as rn\n  FROM sat_data\n) t\nWHERE rn = 1", "relation_name": "`unverified`.`sat_rdv__ind`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:13.592896Z", "completed_at": "2025-12-09T10:56:13.599177Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:13.599569Z", "completed_at": "2025-12-09T10:56:14.910140Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.3503668308258057, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_metric", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u043c\u0435\u0442\u0440\u0438\u043a\u043e\u0439\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_metric_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    TRIM(REPLACE(COALESCE(CAST(s.metric AS CHAR), ''), CHAR(160), '')) as metric_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.metric IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(s.metric AS CHAR), ''), CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_metric_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__metric` h ON h.hub_metric_bk = s.metric_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_metric_pk AS CHAR))) as link_ind_metric_pk,\n    hub_ind_pk,\n    hub_metric_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_metric_pk,\n    hub_ind_pk,\n    hub_metric_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_metric_pk, hub_ind_pk, hub_metric_pk\n)\n\nSELECT\n  link_ind_metric_pk,\n  hub_ind_pk,\n  hub_metric_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_metric`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:14.947869Z", "completed_at": "2025-12-09T10:56:14.957767Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:14.958277Z", "completed_at": "2025-12-09T10:56:16.213706Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2953851222991943, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_organization", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0435\u0439\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_organization_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.org_name IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    h.hub_organization_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__organization` h ON h.hub_organization_bk = s.org_name_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_organization_pk AS CHAR))) as link_ind_organization_pk,\n    hub_ind_pk,\n    hub_organization_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_organization_pk,\n    hub_ind_pk,\n    hub_organization_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_organization_pk, hub_ind_pk, hub_organization_pk\n)\n\nSELECT\n  link_ind_organization_pk,\n  hub_ind_pk,\n  hub_organization_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_organization`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:16.248125Z", "completed_at": "2025-12-09T10:56:16.257558Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:16.258041Z", "completed_at": "2025-12-09T10:56:17.413186Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.195242166519165, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_unit", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0435\u0434\u0438\u043d\u0438\u0446\u0435\u0439 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_unit_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    hu.hub_unit_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__unit` hu ON hu.hub_unit_bk = s.unit_name_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_unit_pk AS CHAR))) as link_ind_unit_pk,\n    hub_ind_pk,\n    hub_unit_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_unit_pk,\n    hub_ind_pk,\n    hub_unit_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_unit_pk, hub_ind_pk, hub_unit_pk\n)\n\nSELECT\n  link_ind_unit_pk,\n  hub_ind_pk,\n  hub_unit_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_unit`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:17.447538Z", "completed_at": "2025-12-09T10:56:17.456132Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:17.456607Z", "completed_at": "2025-12-09T10:56:18.928263Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.510631799697876, "adapter_response": {"_message": "SUCCESS 544", "code": "SUCCESS", "rows_affected": 544}, "message": "SUCCESS 544", "failures": null, "unique_id": "model.proekt_shablon_1.link_rdv_ind_value_type", "compiled": true, "compiled_code": "\n\n-- Link \u043c\u0435\u0436\u0434\u0443 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u043c \u0438 \u0442\u0438\u043f\u043e\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f\n-- PK \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u043a\u0430\u043a MD5(hub_ind_pk|hub_value_type_pk)\n-- \u041f\u043e\u043b\u043d\u043e\u0435 \u043f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0442\u0430\u0431\u043b\u0438\u0446\u044b \u043f\u0440\u0438 \u043a\u0430\u0436\u0434\u043e\u043c \u0437\u0430\u043f\u0443\u0441\u043a\u0435\n\nWITH staging_normalized AS (\n  SELECT\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')) as unit_name_norm,\n    TRIM(REPLACE(s.data_type, CHAR(160), '')) as data_type_norm,\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')) as discreteness_norm,\n    TRIM(REPLACE(s.value_type, CHAR(160), '')) as value_type_norm,\n    TRIM(REPLACE(s.org_name, CHAR(160), '')) as org_name_norm,\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')) as eat_name_norm,\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')) as asset_name_norm,\n    TRIM(REPLACE(s.ind_code, CHAR(160), '')) as ind_code_norm,\n    MAX(s.load_dttm) as load_dttm,\n    ANY_VALUE(s.source_nm) as source_nm\n  FROM t1_stage.stg_source_data_new s\n  WHERE s.ind_code IS NOT NULL\n    AND s.value_type IS NOT NULL\n    AND s.unit_name IS NOT NULL\n    AND s.data_type IS NOT NULL\n    AND s.discreteness IS NOT NULL\n    AND s.org_name IS NOT NULL \n    AND s.eat_name IS NOT NULL \n    AND s.asset_name IS NOT NULL\n  \n  GROUP BY\n    TRIM(REPLACE(s.unit_name, CHAR(160), '')),\n    TRIM(REPLACE(s.data_type, CHAR(160), '')),\n    TRIM(REPLACE(s.discreteness, CHAR(160), '')),\n    TRIM(REPLACE(s.value_type, CHAR(160), '')),\n    TRIM(REPLACE(s.org_name, CHAR(160), '')),\n    TRIM(REPLACE(s.eat_name, CHAR(160), '')),\n    TRIM(REPLACE(s.asset_name, CHAR(160), '')),\n    TRIM(REPLACE(s.ind_code, CHAR(160), ''))\n),\n\nlinks_with_hubs AS (\n  SELECT\n    hi.hub_ind_pk,\n    hvt.hub_value_type_pk,\n    s.load_dttm,\n    s.source_nm\n  FROM staging_normalized s\n  INNER JOIN `unverified`.`hub_rdv__ind` hi ON hi.hub_ind_bk = CONCAT_WS('|', \n    s.unit_name_norm,\n    s.data_type_norm,\n    s.discreteness_norm,\n    s.value_type_norm,\n    s.org_name_norm,\n    s.eat_name_norm,\n    s.asset_name_norm,\n    s.ind_code_norm\n  )\n  INNER JOIN `unverified`.`hub_rdv__value_type` hvt ON hvt.hub_value_type_bk = s.value_type_norm\n),\n\nlink_data AS (\n  SELECT\n    MD5(CONCAT_WS('|', CAST(hub_ind_pk AS CHAR), CAST(hub_value_type_pk AS CHAR))) as link_ind_value_type_pk,\n    hub_ind_pk,\n    hub_value_type_pk,\n    load_dttm,\n    source_nm\n  FROM links_with_hubs\n),\n\ndeduplicated_links AS (\n  SELECT\n    link_ind_value_type_pk,\n    hub_ind_pk,\n    hub_value_type_pk,\n    MAX(load_dttm) as load_dttm,\n    ANY_VALUE(source_nm) as source_nm\n  FROM link_data\n  GROUP BY link_ind_value_type_pk, hub_ind_pk, hub_value_type_pk\n)\n\nSELECT\n  link_ind_value_type_pk,\n  hub_ind_pk,\n  hub_value_type_pk,\n  load_dttm,\n  source_nm\nFROM deduplicated_links", "relation_name": "`unverified`.`link_rdv__ind_value_type`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:18.965109Z", "completed_at": "2025-12-09T10:56:18.976158Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:18.976691Z", "completed_at": "2025-12-09T10:56:20.114785Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.1778550148010254, "adapter_response": {"_message": "SUCCESS 5", "code": "SUCCESS", "rows_affected": 5}, "message": "SUCCESS 5", "failures": null, "unique_id": "model.proekt_shablon_1.stg_calc_facts", "compiled": true, "compiled_code": "\n\n-- \u0412\u0440\u0435\u043c\u0435\u043d\u043d\u0430\u044f \u0442\u0430\u0431\u043b\u0438\u0446\u0430 \u0441 \u0440\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u043c\u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044f\u043c\u0438\n-- \u0421\u043e\u0437\u0434\u0430\u0435\u0442\u0441\u044f \u043d\u0430\u043f\u0440\u044f\u043c\u0443\u044e \u0438\u0437 stg_source_data_new \u0438 \u041d\u0415 \u043f\u043e\u043f\u0430\u0434\u0430\u0435\u0442 \u043f\u043e\u0434 LIMIT \u0431\u0430\u0437\u043e\u0432\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445\n\nWITH \n-- \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u043e\u0432\u044b\u0445 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u043e \u043a\u043e\u0434\u0430\u043c \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 1\nform_1_base_values AS (\n  SELECT \n    s.year,\n    s.quarter,\n    \n  CASE \n    WHEN s.quarter = 1 THEN STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n    WHEN s.quarter = 2 THEN STR_TO_DATE(CONCAT(s.year, '-04-01'), '%Y-%m-%d')\n    WHEN s.quarter = 3 THEN STR_TO_DATE(CONCAT(s.year, '-07-01'), '%Y-%m-%d')\n    WHEN s.quarter = 4 THEN STR_TO_DATE(CONCAT(s.year, '-10-01'), '%Y-%m-%d')\n    ELSE STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n  END\n as period_dt,\n    DATE(s.load_dttm) as report_date,\n    s.source_nm,\n    s.load_dttm,\n    s.ind_code,\n    s.value_current_year as value_amt\n  FROM `stage`.`stg_source_data_new` s\n  WHERE s.source_nm = 'raw.accounting_balance_form_1'\n    AND s.ind_code IN ('1250', '1170', '1410', '1510', '1230', '1520', '1440', '1450', '1550', '1232', '1240', '1252', '1232.3', '1232.4')\n    AND s.value_current_year IS NOT NULL\n    AND s.year IS NOT NULL\n    AND s.quarter IS NOT NULL\n),\n\n-- Pivot \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u043f\u043e \u043a\u043e\u0434\u0430\u043c \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u0444\u043e\u0440\u043c\u0443\u043b (\u0424\u043e\u0440\u043c\u0430 1)\nform_1_pivoted AS (\n  SELECT \n    year,\n    quarter,\n    period_dt,\n    report_date,\n    source_nm,\n    MAX(load_dttm) as load_dttm,\n    SUM(CASE WHEN ind_code = '1250' THEN value_amt ELSE 0 END) as val_1250,\n    SUM(CASE WHEN ind_code = '1170' THEN value_amt ELSE 0 END) as val_1170,\n    SUM(CASE WHEN ind_code = '1410' THEN value_amt ELSE 0 END) as val_1410,\n    SUM(CASE WHEN ind_code = '1510' THEN value_amt ELSE 0 END) as val_1510,\n    SUM(CASE WHEN ind_code = '1230' THEN value_amt ELSE 0 END) as val_1230,\n    SUM(CASE WHEN ind_code = '1520' THEN value_amt ELSE 0 END) as val_1520,\n    SUM(CASE WHEN ind_code = '1440' THEN value_amt ELSE 0 END) as val_1440,\n    SUM(CASE WHEN ind_code = '1450' THEN value_amt ELSE 0 END) as val_1450,\n    SUM(CASE WHEN ind_code = '1550' THEN value_amt ELSE 0 END) as val_1550,\n    SUM(CASE WHEN ind_code = '1232' THEN value_amt ELSE 0 END) as val_1232,\n    SUM(CASE WHEN ind_code = '1240' THEN value_amt ELSE 0 END) as val_1240,\n    SUM(CASE WHEN ind_code = '1252' THEN value_amt ELSE 0 END) as val_1252,\n    SUM(CASE WHEN ind_code = '1232.3' THEN value_amt ELSE 0 END) as val_1232_3,\n    SUM(CASE WHEN ind_code = '1232.4' THEN value_amt ELSE 0 END) as val_1232_4\n  FROM form_1_base_values\n  GROUP BY year, quarter, period_dt, report_date, source_nm\n),\n\n-- \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f \u0431\u0430\u0437\u043e\u0432\u044b\u0445 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u043e \u043a\u043e\u0434\u0430\u043c \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 2\nform_2_base_values AS (\n  SELECT \n    s.year,\n    s.quarter,\n    \n  CASE \n    WHEN s.quarter = 1 THEN STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n    WHEN s.quarter = 2 THEN STR_TO_DATE(CONCAT(s.year, '-04-01'), '%Y-%m-%d')\n    WHEN s.quarter = 3 THEN STR_TO_DATE(CONCAT(s.year, '-07-01'), '%Y-%m-%d')\n    WHEN s.quarter = 4 THEN STR_TO_DATE(CONCAT(s.year, '-10-01'), '%Y-%m-%d')\n    ELSE STR_TO_DATE(CONCAT(s.year, '-01-01'), '%Y-%m-%d')\n  END\n as period_dt,\n    DATE(s.load_dttm) as report_date,\n    s.source_nm,\n    s.load_dttm,\n    s.ind_code,\n    s.value_current_year as value_amt\n  FROM `stage`.`stg_source_data_new` s\n  WHERE s.source_nm = 'raw.accounting_balance_form_2'\n    AND s.ind_code IN ('2400', '2120', '2110')\n    AND s.value_current_year IS NOT NULL\n    AND s.year IS NOT NULL\n    AND s.quarter IS NOT NULL\n),\n\n-- Pivot \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u043f\u043e \u043a\u043e\u0434\u0430\u043c \u0434\u043b\u044f \u0432\u044b\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u044f \u0444\u043e\u0440\u043c\u0443\u043b (\u0424\u043e\u0440\u043c\u0430 2)\nform_2_pivoted AS (\n  SELECT \n    year,\n    quarter,\n    period_dt,\n    report_date,\n    source_nm,\n    MAX(load_dttm) as load_dttm,\n    SUM(CASE WHEN ind_code = '2400' THEN value_amt ELSE 0 END) as val_2400,\n    SUM(CASE WHEN ind_code = '2120' THEN value_amt ELSE 0 END) as val_2120,\n    SUM(CASE WHEN ind_code = '2110' THEN value_amt ELSE 0 END) as val_2110\n  FROM form_2_base_values\n  GROUP BY year, quarter, period_dt, report_date, source_nm\n),\n\n-- \u0412\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u043c \u0440\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 1\nform_1_calculated AS (\n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10107' AS VARCHAR(500)) as calc_ind_code,\n    val_1250 as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE val_1250 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10108' AS VARCHAR(500)) as calc_ind_code,\n    val_1170 as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE val_1170 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10109' AS VARCHAR(500)) as calc_ind_code,\n    COALESCE(val_1410, 0) + COALESCE(val_1510, 0) as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE val_1410 IS NOT NULL OR val_1510 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10110' AS VARCHAR(500)) as calc_ind_code,\n    val_1230 as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE val_1230 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10111' AS VARCHAR(500)) as calc_ind_code,\n    COALESCE(val_1520, 0) + COALESCE(val_1440, 0) + COALESCE(val_1450, 0) + COALESCE(val_1550, 0) as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE val_1520 IS NOT NULL OR val_1440 IS NOT NULL OR val_1450 IS NOT NULL OR val_1550 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10117' AS VARCHAR(500)) as calc_ind_code,\n    CASE \n      WHEN (COALESCE(val_1510, 0) + COALESCE(val_1520, 0)) != 0 \n      THEN (COALESCE(val_1250, 0) + COALESCE(val_1232, 0) + COALESCE(val_1240, 0)) / (COALESCE(val_1510, 0) + COALESCE(val_1520, 0))\n      ELSE NULL\n    END as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE (val_1250 IS NOT NULL OR val_1232 IS NOT NULL OR val_1240 IS NOT NULL)\n    AND (val_1510 IS NOT NULL OR val_1520 IS NOT NULL)\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10118' AS VARCHAR(500)) as calc_ind_code,\n    CASE \n      WHEN COALESCE(val_1520, 0) != 0 \n      THEN (COALESCE(val_1232, 0) + COALESCE(val_1252, 0)) / val_1520\n      ELSE NULL\n    END as calc_value,\n    'raw.accounting_balance_form_1' as calc_source_nm\n  FROM form_1_pivoted\n  WHERE (val_1232 IS NOT NULL OR val_1252 IS NOT NULL)\n    AND val_1520 IS NOT NULL\n),\n\n-- \u0412\u044b\u0447\u0438\u0441\u043b\u044f\u0435\u043c \u0440\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 2\nform_2_calculated AS (\n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10112' AS VARCHAR(500)) as calc_ind_code,\n    val_2400 as calc_value,\n    'raw.accounting_balance_form_2' as calc_source_nm\n  FROM form_2_pivoted\n  WHERE val_2400 IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    period_dt,\n    report_date,\n    source_nm,\n    load_dttm,\n    CAST('10113' AS VARCHAR(500)) as calc_ind_code,\n    val_2120 as calc_value,\n    'raw.accounting_balance_form_2' as calc_source_nm\n  FROM form_2_pivoted\n  WHERE val_2120 IS NOT NULL\n),\n\n-- \u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430 \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 1\nform_1_cumulative AS (\n  SELECT \n    f1.year,\n    f1.quarter,\n    f1.period_dt,\n    f1.report_date,\n    f1.source_nm,\n    f1.load_dttm,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_1520 ELSE 0 END), f1.val_1520) as val_1520_cumulative,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_1232 ELSE 0 END), f1.val_1232) as val_1232_cumulative,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_1232_3 ELSE 0 END), f1.val_1232_3) as val_1232_3_cumulative,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_1232_4 ELSE 0 END), f1.val_1232_4) as val_1232_4_cumulative\n  FROM form_1_pivoted f1\n  LEFT JOIN form_1_pivoted f2 ON f2.year = f1.year AND f2.quarter <= f1.quarter\n  GROUP BY f1.year, f1.quarter, f1.period_dt, f1.report_date, f1.source_nm, f1.load_dttm, f1.val_1520, f1.val_1232, f1.val_1232_3, f1.val_1232_4\n),\n\n-- \u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u043e\u0448\u043b\u043e\u0433\u043e \u0433\u043e\u0434\u0430 (Q4) \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 1\nform_1_prev_year AS (\n  SELECT \n    year + 1 as current_year,\n    val_1520 as val_1520_prev_year,\n    val_1232 as val_1232_prev_year,\n    val_1232_3 as val_1232_3_prev_year,\n    val_1232_4 as val_1232_4_prev_year\n  FROM form_1_pivoted\n  WHERE quarter = 4\n),\n\n-- \u041d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u0439 \u0438\u0442\u043e\u0433 \u043f\u043e \u043a\u0432\u0430\u0440\u0442\u0430\u043b\u0430\u043c \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u0433\u043e\u0434\u0430 \u0434\u043b\u044f \u0424\u043e\u0440\u043c\u044b 2\nform_2_cumulative AS (\n  SELECT \n    f1.year,\n    f1.quarter,\n    f1.period_dt,\n    f1.report_date,\n    f1.source_nm,\n    f1.load_dttm,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_2120 ELSE 0 END), f1.val_2120) as val_2120_cumulative,\n    COALESCE(SUM(CASE WHEN f2.quarter <= f1.quarter AND f2.year = f1.year THEN f2.val_2110 ELSE 0 END), f1.val_2110) as val_2110_cumulative\n  FROM form_2_pivoted f1\n  LEFT JOIN form_2_pivoted f2 ON f2.year = f1.year AND f2.quarter <= f1.quarter\n  GROUP BY f1.year, f1.quarter, f1.period_dt, f1.report_date, f1.source_nm, f1.load_dttm, f1.val_2120, f1.val_2110\n),\n\n-- \u0420\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438 \u0441 \u043d\u0430\u0440\u0430\u0441\u0442\u0430\u044e\u0449\u0438\u043c \u0438\u0442\u043e\u0433\u043e\u043c (10119, 10120)\ncumulative_calculated AS (\n  SELECT\n    f2c.period_dt,\n    f2c.report_date,\n    f2c.source_nm,\n    f2c.load_dttm,\n    CAST('10119' AS VARCHAR(500)) as calc_ind_code,\n    CASE \n      WHEN (COALESCE(f1c.val_1520_cumulative, 0) + COALESCE(f1py.val_1520_prev_year, 0)) != 0\n      THEN f2c.val_2120_cumulative / ((f1c.val_1520_cumulative + COALESCE(f1py.val_1520_prev_year, 0)) / 2)\n      ELSE NULL\n    END as calc_value,\n    'raw.accounting_balance_form_2' as calc_source_nm\n  FROM form_2_cumulative f2c\n  INNER JOIN form_1_cumulative f1c ON f2c.year = f1c.year AND f2c.quarter = f1c.quarter\n  LEFT JOIN form_1_prev_year f1py ON f2c.year = f1py.current_year\n  WHERE f2c.val_2120_cumulative IS NOT NULL\n    AND f1c.val_1520_cumulative IS NOT NULL\n  \n  UNION ALL\n  \n  SELECT\n    f2c.period_dt,\n    f2c.report_date,\n    f2c.source_nm,\n    f2c.load_dttm,\n    CAST('10120' AS VARCHAR(500)) as calc_ind_code,\n    CASE \n      WHEN ((COALESCE(f1c.val_1232_cumulative, 0) - COALESCE(f1c.val_1232_3_cumulative, 0) - COALESCE(f1c.val_1232_4_cumulative, 0)) + \n            (COALESCE(f1py.val_1232_prev_year, 0) - COALESCE(f1py.val_1232_3_prev_year, 0) - COALESCE(f1py.val_1232_4_prev_year, 0))) != 0\n      THEN f2c.val_2110_cumulative / (((f1c.val_1232_cumulative - COALESCE(f1c.val_1232_3_cumulative, 0) - COALESCE(f1c.val_1232_4_cumulative, 0)) + \n                                       (COALESCE(f1py.val_1232_prev_year, 0) - COALESCE(f1py.val_1232_3_prev_year, 0) - COALESCE(f1py.val_1232_4_prev_year, 0))) / 2)\n      ELSE NULL\n    END as calc_value,\n    'raw.accounting_balance_form_2' as calc_source_nm\n  FROM form_2_cumulative f2c\n  INNER JOIN form_1_cumulative f1c ON f2c.year = f1c.year AND f2c.quarter = f1c.quarter\n  LEFT JOIN form_1_prev_year f1py ON f2c.year = f1py.current_year\n  WHERE f2c.val_2110_cumulative IS NOT NULL\n    AND f1c.val_1232_cumulative IS NOT NULL\n),\n\n-- \u041e\u0431\u044a\u0435\u0434\u0438\u043d\u044f\u0435\u043c \u0432\u0441\u0435 \u0440\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0438\nall_calculated AS (\n  SELECT * FROM form_1_calculated\n  UNION ALL\n  SELECT * FROM form_2_calculated\n  UNION ALL\n  SELECT * FROM cumulative_calculated\n),\n\n-- \u0421\u043e\u0437\u0434\u0430\u0435\u043c hub_fact_bk \u0438 hub_fact_pk \u0434\u043b\u044f \u0440\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0445 \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439\ncalc_fact_bk_with_bk AS (\n  SELECT\n    c.period_dt,\n    c.report_date,\n    c.load_dttm,\n    c.calc_source_nm as source_nm,\n    c.calc_ind_code,\n    c.calc_value,\n    \n  -- \u0413\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f hub_fact_bk (business key) \u0431\u0435\u0437 MD5 \u0445\u0435\u0448\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f\n  -- \u041d\u043e\u0440\u043c\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f: TRIM + \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u043d\u0435\u0440\u0430\u0437\u0440\u044b\u0432\u043d\u044b\u0445 \u043f\u0440\u043e\u0431\u0435\u043b\u043e\u0432 (CHAR(160))\n  CONCAT_WS('|', \n    TRIM(REPLACE(COALESCE(CAST(c.calc_ind_code AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(c.period_dt AS CHAR), ''), CHAR(160), '')),\n    TRIM(REPLACE(COALESCE(CAST(c.report_date AS CHAR), ''), CHAR(160), ''))\n  )\n as hub_fact_bk\n  FROM all_calculated c\n  WHERE c.calc_value IS NOT NULL\n),\n\ncalc_fact_bk_grouped AS (\n  SELECT\n    hub_fact_bk,\n    MAX(period_dt) as period_dt,\n    MAX(report_date) as report_date,\n    MAX(load_dttm) as load_dttm,\n    MAX(source_nm) as source_nm,\n    MAX(calc_ind_code) as calc_ind_code,\n    MAX(calc_value) as calc_value\n  FROM calc_fact_bk_with_bk\n  GROUP BY hub_fact_bk\n),\n\ncalc_fact_bk AS (\n  SELECT\n    c.hub_fact_bk,\n    MD5(c.hub_fact_bk) as hub_fact_pk,\n    c.calc_ind_code as bk_hub_ind_pk,\n    c.period_dt as bk_period_dt,\n    c.report_date as bk_report_date,\n    c.load_dttm,\n    c.source_nm,\n    c.calc_value\n  FROM calc_fact_bk_grouped c\n)\n\n-- \u0424\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0437\u0430\u043f\u0438\u0441\u0438 \u0434\u043b\u044f \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0442\u0430\u0431\u043b\u0438\u0446\u044b\nSELECT\n  hub_fact_pk,\n  bk_hub_ind_pk,\n  bk_period_dt,\n  bk_report_date,\n  load_dttm,\n  source_nm,\n  calc_value as value_amt\nFROM calc_fact_bk", "relation_name": "`stage`.`stg_calc_facts`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:20.146827Z", "completed_at": "2025-12-09T10:56:20.151980Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:20.152630Z", "completed_at": "2025-12-09T10:56:20.909641Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.7933330535888672, "adapter_response": {"_message": "SUCCESS 1000", "code": "SUCCESS", "rows_affected": 1000}, "message": "SUCCESS 1000", "failures": null, "unique_id": "model.proekt_shablon_1.sat_bdv_fact", "compiled": true, "compiled_code": "\n\n-- BDV Satellite \u0434\u043b\u044f \u0444\u0430\u043a\u0442\u043e\u0432: \u043a\u043e\u043f\u0438\u044f RDV\n\nSELECT\n  hub_fact_pk,\n  load_date,\n  period_dt,\n  report_date,\n  source_nm\nFROM `unverified`.`sat_rdv__fact`", "relation_name": "`unverified`.`sat_bdv__fact`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:20.946475Z", "completed_at": "2025-12-09T10:56:20.956040Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:20.956543Z", "completed_at": "2025-12-09T10:56:22.200105Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.2844648361206055, "adapter_response": {"_message": "SUCCESS 1005", "code": "SUCCESS", "rows_affected": 1005}, "message": "SUCCESS 1005", "failures": null, "unique_id": "model.proekt_shablon_1.hub_bdv_fact", "compiled": true, "compiled_code": "\n\n-- BDV Hub \u0434\u043b\u044f \u0444\u0430\u043a\u0442\u043e\u0432: RDV + \u0440\u0430\u0441\u0447\u0451\u0442\u043d\u044b\u0435 calc \u0438\u0437 stg_calc_facts\n\nWITH rdv AS (\n  SELECT\n    hub_fact_pk,\n    bk_hub_ind_pk,\n    bk_period_dt,\n    bk_report_date,\n    load_dttm,\n    source_nm\n  FROM `unverified`.`hub_rdv__fact`\n),\n\ncalc_values AS (\n  SELECT\n    CAST(bk_hub_ind_pk AS VARCHAR) AS ind_code,\n    bk_period_dt AS period_dt,\n    bk_report_date AS report_date,\n    load_dttm,\n    source_nm\n  FROM `stage`.`stg_calc_facts`\n),\n\ncalc_ind AS (\n  SELECT DISTINCT\n    MD5(LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    ))) AS hub_ind_pk,\n    LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    )) AS hub_ind_bk\n  FROM calc_values\n),\n\ncalc_fact AS (\n  SELECT DISTINCT\n    \n  MD5(\n    CONCAT_WS('|', \n      TRIM(REPLACE(COALESCE(CAST(ci.hub_ind_pk AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(cv.period_dt AS CHAR) AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(cv.report_date AS CHAR) AS CHAR), ''), CHAR(160), ''))\n    )\n  )\n AS hub_fact_pk,\n    ci.hub_ind_pk AS bk_hub_ind_pk,\n    cv.period_dt AS bk_period_dt,\n    cv.report_date AS bk_report_date,\n    cv.load_dttm,\n    cv.source_nm\n  FROM calc_values cv\n  JOIN calc_ind ci ON LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      cv.ind_code\n    )) = ci.hub_ind_bk\n)\n\nSELECT DISTINCT\n  hub_fact_pk,\n  bk_hub_ind_pk,\n  bk_period_dt,\n  bk_report_date,\n  load_dttm,\n  source_nm\nFROM rdv\n\nUNION ALL\n\nSELECT DISTINCT\n  hub_fact_pk,\n  bk_hub_ind_pk,\n  bk_period_dt,\n  bk_report_date,\n  load_dttm,\n  source_nm\nFROM calc_fact", "relation_name": "`unverified`.`hub_bdv__fact`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:22.240934Z", "completed_at": "2025-12-09T10:56:22.249596Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:22.250054Z", "completed_at": "2025-12-09T10:56:23.198479Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.9869697093963623, "adapter_response": {"_message": "SUCCESS 663", "code": "SUCCESS", "rows_affected": 663}, "message": "SUCCESS 663", "failures": null, "unique_id": "model.proekt_shablon_1.hub_bdv_ind", "compiled": true, "compiled_code": "\n\n-- BDV Hub \u0434\u043b\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439: RDV + \u0440\u0430\u0441\u0447\u0451\u0442\u043d\u044b\u0435 calc \u0438\u0437 stg_calc_facts\n\nWITH rdv AS (\n  SELECT\n    hub_ind_pk,\n    hub_ind_bk,\n    load_dttm,\n    source_nm\n  FROM `unverified`.`hub_rdv__ind`\n),\n\ncalc_values AS (\n  SELECT DISTINCT\n    CAST(bk_hub_ind_pk AS VARCHAR) AS ind_code,\n    load_dttm,\n    source_nm\n  FROM `stage`.`stg_calc_facts`\n),\n\ncalc_ind AS (\n  SELECT DISTINCT\n    MD5(LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    ))) AS hub_ind_pk,\n    LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    )) AS hub_ind_bk,\n    load_dttm,\n    source_nm\n  FROM calc_values\n)\n\nSELECT DISTINCT\n  hub_ind_pk,\n  hub_ind_bk,\n  load_dttm,\n  source_nm\nFROM rdv\n\nUNION ALL\n\nSELECT DISTINCT\n  hub_ind_pk,\n  hub_ind_bk,\n  load_dttm,\n  source_nm\nFROM calc_ind", "relation_name": "`unverified`.`hub_bdv__ind`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:23.233218Z", "completed_at": "2025-12-09T10:56:23.245545Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:23.245975Z", "completed_at": "2025-12-09T10:56:24.045640Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.8424332141876221, "adapter_response": {"_message": "SUCCESS 1005", "code": "SUCCESS", "rows_affected": 1005}, "message": "SUCCESS 1005", "failures": null, "unique_id": "model.proekt_shablon_1.sat_bdv_fact_value", "compiled": true, "compiled_code": "\n\n-- BDV Satellite \u0434\u043b\u044f \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0439 \u0444\u0430\u043a\u0442\u043e\u0432: RDV + \u0440\u0430\u0441\u0447\u0451\u0442\u043d\u044b\u0435 calc \u0438\u0437 stg_calc_facts\n\nWITH rdv AS (\n  SELECT\n    hub_fact_pk,\n    load_date,\n    value_amt,\n    source_nm\n  FROM `unverified`.`sat_rdv__fact_value`\n),\n\ncalc_values AS (\n  SELECT\n    CAST(bk_hub_ind_pk AS VARCHAR) AS ind_code,\n    bk_period_dt AS period_dt,\n    bk_report_date AS load_date,\n    value_amt,\n    source_nm\n  FROM `stage`.`stg_calc_facts`\n  WHERE value_amt IS NOT NULL\n),\n\ncalc_ind AS (\n  SELECT DISTINCT\n    LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    )) AS hub_ind_bk,\n    MD5(LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      ind_code\n    ))) AS hub_ind_pk\n  FROM calc_values\n),\n\ncalc_fact AS (\n  SELECT DISTINCT\n    \n  MD5(\n    CONCAT_WS('|', \n      TRIM(REPLACE(COALESCE(CAST(ci.hub_ind_pk AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(cv.period_dt AS CHAR) AS CHAR), ''), CHAR(160), '')),\n      TRIM(REPLACE(COALESCE(CAST(CAST(cv.load_date AS CHAR) AS CHAR), ''), CHAR(160), ''))\n    )\n  )\n AS hub_fact_pk,\n    cv.load_date,\n    cv.value_amt,\n    cv.source_nm\n  FROM calc_values cv\n  JOIN calc_ind ci ON ci.hub_ind_bk = LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      cv.ind_code\n    ))\n)\n\nSELECT DISTINCT\n  hub_fact_pk,\n  load_date,\n  value_amt,\n  source_nm\nFROM rdv\n\nUNION ALL\n\nSELECT DISTINCT\n  hub_fact_pk,\n  load_date,\n  value_amt,\n  source_nm\nFROM calc_fact", "relation_name": "`unverified`.`sat_bdv__fact_value`", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-09T10:56:24.080203Z", "completed_at": "2025-12-09T10:56:24.088018Z"}, {"name": "execute", "started_at": "2025-12-09T10:56:24.088515Z", "completed_at": "2025-12-09T10:56:24.874555Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.8213822841644287, "adapter_response": {"_message": "SUCCESS 663", "code": "SUCCESS", "rows_affected": 663}, "message": "SUCCESS 663", "failures": null, "unique_id": "model.proekt_shablon_1.sat_bdv_ind", "compiled": true, "compiled_code": "\n\n-- BDV Satellite \u0434\u043b\u044f \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u0435\u0439: RDV + \u0440\u0430\u0441\u0447\u0451\u0442\u043d\u044b\u0435 calc \u0438\u0437 stg_calc_facts\n\nWITH rdv AS (\n  SELECT\n    hub_ind_pk,\n    load_dttm,\n    name,\n    code,\n    valid_from,\n    valid_to,\n    source_nm\n  FROM `unverified`.`sat_rdv__ind`\n),\n\ncalc_ind AS (\n  SELECT DISTINCT\n    MD5(LOWER(CONCAT_WS('|',\n      'calc_unit',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      'calc',\n      CAST(bk_hub_ind_pk AS VARCHAR)\n    ))) AS hub_ind_pk,\n    load_dttm,\n    CAST(bk_hub_ind_pk AS VARCHAR) AS name,\n    CAST(bk_hub_ind_pk AS VARCHAR) AS code,\n    load_dttm AS valid_from,\n    CAST('9999-12-31 23:59:59' AS DATETIME) AS valid_to,\n    source_nm\n  FROM `stage`.`stg_calc_facts`\n)\n\nSELECT DISTINCT\n  hub_ind_pk,\n  load_dttm,\n  name,\n  code,\n  valid_from,\n  valid_to,\n  source_nm\nFROM rdv\n\nUNION ALL\n\nSELECT DISTINCT\n  hub_ind_pk,\n  load_dttm,\n  name,\n  code,\n  valid_from,\n  valid_to,\n  source_nm\nFROM calc_ind", "relation_name": "`unverified`.`sat_bdv__ind`", "batch_results": null}], "elapsed_time": 41.90875816345215, "args": {"write_json": true, "validate_macro_args": false, "invocation_command": "dbt run --profiles-dir .", "require_yaml_configuration_for_mf_time_spines": false, "require_explicit_package_overrides_for_builtin_materializations": true, "profiles_dir": ".", "skip_nodes_if_on_run_start_fails": false, "print": true, "partial_parse": true, "populate_cache": true, "state_modified_compare_vars": false, "favor_state": false, "use_colors": true, "version_check": true, "quiet": false, "which": "run", "introspect": true, "log_level": "info", "partial_parse_file_diff": true, "strict_mode": false, "vars": {}, "log_path": "/Users/aleksankdrcernaev/Documents/\u041b\u0425\u0414/SR/2/\u041f\u0440\u043e\u0435\u043a\u0442 \u0428\u0430\u0431\u043b\u043e\u043d 2/logs", "require_nested_cumulative_type_params": false, "source_freshness_run_project_hooks": true, "cache_selected_only": false, "empty": false, "require_all_warnings_handled_by_warn_error": false, "require_resource_names_without_spaces": true, "macro_debugging": false, "defer": false, "log_format": "default", "use_colors_file": true, "use_fast_test_edges": false, "state_modified_compare_more_unrendered_values": false, "log_level_file": "debug", "show_all_deprecations": false, "upload_to_artifacts_ingest_api": false, "send_anonymous_usage_stats": true, "require_generic_test_arguments_property": true, "log_file_max_bytes": 10485760, "indirect_selection": "eager", "select": [], "show_resource_report": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "require_batched_execution_for_custom_microbatch_strategy": false, "project_dir": "/Users/aleksankdrcernaev/Documents/\u041b\u0425\u0414/SR/2/\u041f\u0440\u043e\u0435\u043a\u0442 \u0428\u0430\u0431\u043b\u043e\u043d 2", "log_format_file": "debug", "printer_width": 80, "static_parser": true, "exclude": []}}